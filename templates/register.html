{% extends 'panel_base.html' %}
{% load static %}

{% block styles %}
<style>
.field input[type=text]{
    border: 1px solid #cdcdcd;
}
.ui.input {
    padding: 5px;
}
.rtl {
    flex-direction: row-reverse;
    text-align: right;
    direction: rtl;
}

#reg-form input[type=text] {
    text-align: right;
}

.checkbox-container {
    display: flex;
    flex-wrap: wrap;
}

.checkbox-container .checkbox-header {
    padding: 10px 2px;
    font-weight: bold;
}

.checkbox-container .field {
    padding: 10px;
}
</style>
{% endblock styles %}


{% block content %}

<div dir="rtl" class="ui center aligned grid" style="direction: rtl; padding-top: 100px; background-color: #fafafa;">
    <div class="fourteen wide mobile ten wide tablet ten wide computer column">
        {% if registration_error %}
        <div class="ui message error" style="text-align: right;">
            {{ registration_error }}
        </div>
        {% endif %}
        <div class="ui message info" style="text-align: right;">
            قبلا ثبت نام کرده اید؟  <a style="padding: 0px 4px; text-decoration: underline" href="{% url 'login' %}">وارد شوید</a>
        </div>
        <div class="ui message info" style="text-align: right;">
            لطفا پیش از ثبت نام <a style="padding: 0px 4px; text-decoration: underline" href="{% static 'registration-help.pdf' %}">فایل نحوه ی ثبت نام</a> را به دقت مطالعه فرمایید.
        </div>
        <form @submit="submitForm" class="ui from rtl" id="reg-form" method="POST" enctype="multipart/form-data" action="">
        {% csrf_token %}
        <input type="hidden" name="form_data_json" :value="formDataJson" />
        {% verbatim %}
            <div class="ui padded raised right aligned segment">

                <h3 class="ui right aligned header" >
                        اطلاعات اولیه
                </h3>
                <div class="fields">
                    <div class="field">
                        <div class="ui input">
                            <input type="text" v-model="manager.name" required placeholder="نام و نام خانوادگی" name="manager_name">
                        </div>



                        <div class="ui input">
                            <input type="tel"
                            pattern="[0-9]{10}" v-model="manager.national_id" required placeholder="کد ملی" name="manager_national_id">
                        </div>
                        <div class="ui input">
                            <input type="tel"
                            pattern="[0-9]{11}" v-model="manager.phone_number" required placeholder="شماره تلفن" name="manager_phone_number">
                        </div>


                    </div>
                    <div class="field">
                      <div class="ui input">
                          <input type="text" v-model="manager.university" required placeholder="دانشگاه" name="manager_university">
                      </div>
                      <div class="ui input">
                          <input type="email" v-model="manager.email" required placeholder="ایمیل" name="manager_email">
                      </div>
                    </div>

                    <div class="fields">
                        <div class="ui input">
                            <input type="password" v-model="manager.password_1" required placeholder="کلمه عبور" name="manager_password_1">
                        </div>

                        <div class="ui input">
                            <input type="password" v-model="manager.password_2" required placeholder="تکرار کلمه عبور" name="manager_password_2">
                        </div>
                    </div>
                </div>
            </div>
            <input type="submit" value="ثبت نام" class="ui primary button" />
        </form>
        {% endverbatim %}
    </div>
</div>
{% endblock content %}

{% block scripts %}
<script src="{% static 'vue.min.js' %}"></script>
<script>
    $(document).ready(function(){
        $('.ui.checkbox').checkbox();
    })
</script>
<script>
    new Vue({
        el: '#reg-form',
        computed: {
        },
        data: {
            formDataJson: '',
            manager: {
                password_1: '',
                password_2: '',
                name: '',
                phone_number: '',
                national_id: '',
                university: '',
                email: '',
            },
        },
        methods: {
            submitForm(e){
                let formValid = true;
                if(this.manager.password_1 != this.manager.password_2){
                    alert('کلمه عبور با تکرار همخوانی ندارد');
                    formValid = false;
                }

                if(!formValid){
                    e.preventDefault();
                } else {
                    this.formDataJson = JSON.stringify({
                        manager: this.manager,
                    });
                    return true;
                }
            }
        },
        created(){
            let formDataJsonString = '{{ form_data_json | safe }}';
            if(formDataJsonString){
                console.log('saved form data loaded')
                this.formDataJson = JSON.parse(formDataJsonString);
                this.manager = this.formDataJson.manager
            }

            console.log('created');
        },
        mounted(){
            console.log('mounted');
        },
        updated(){
            $('.ui.checkbox').checkbox();
        }
    });
</script>
{% endblock scripts %}
